<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Кросфіт Таймер</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: white;
            color: black;
            min-height: 100vh;
            padding: 16px;
        }

        .container {
            max-width: 512px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: black;
            margin-bottom: 8px;
        }

        .header .line {
            height: 2px;
            background-color: black;
            width: 80px;
            margin: 0 auto 8px;
        }

        .header p {
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
            letter-spacing: 0.1em;
        }

        .counter {
            background-color: #f3f4f6;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            text-align: center;
        }

        .counter-label {
            font-size: 1.125rem;
            font-weight: 700;
            color: #374151;
            margin-bottom: 8px;
            letter-spacing: 0.025em;
        }

        .counter-value {
            font-size: 3.75rem;
            font-weight: 900;
            color: black;
            margin-bottom: 16px;
        }

        .counter-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        .mode-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 32px;
        }

        .mode-btn {
            padding: 16px;
            border-radius: 8px;
            border: 2px solid #d1d5db;
            background-color: white;
            color: black;
            font-weight: 700;
            font-size: 0.875rem;
            letter-spacing: 0.025em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-btn.active {
            background-color: black;
            color: white;
            border-color: black;
        }

        .mode-btn:hover:not(.active) {
            border-color: black;
        }

        .display {
            background-color: black;
            color: white;
            border-radius: 8px;
            padding: 32px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: #374151;
        }

        .progress-fill {
            height: 100%;
            background-color: white;
            transition: width 1s ease;
        }

        .status {
            text-align: center;
            margin-bottom: 16px;
            font-size: 0.875rem;
            color: #9ca3af;
            letter-spacing: 0.1em;
            font-weight: 500;
        }

        .time {
            font-size: 4.5rem;
            font-weight: 700;
            text-align: center;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.025em;
            margin-bottom: 8px;
        }

        .time.countdown {
            color: #ef4444;
        }

        .indicator {
            text-align: center;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #6b7280;
            display: inline-block;
        }

        .dot.running {
            background-color: white;
            animation: pulse 1s infinite;
        }

        .dot.countdown {
            background-color: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 32px;
        }

        .control-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            font-weight: 700;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .start-btn {
            background-color: #10b981;
            color: white;
        }

        .start-btn:hover {
            background-color: #059669;
        }

        .pause-btn {
            background-color: #ef4444;
            color: white;
        }

        .pause-btn:hover {
            background-color: #dc2626;
        }

        .reset-btn, .settings-btn {
            background-color: #d1d5db;
            color: black;
        }

        .reset-btn:hover, .settings-btn:hover {
            background-color: #9ca3af;
        }

        .settings-btn.active {
            background-color: black;
            color: white;
        }

        .settings {
            background-color: #f3f4f6;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .settings h3 {
            font-size: 1.25rem;
            font-weight: 700;
            text-align: center;
            color: black;
            margin-bottom: 24px;
        }

        .setting-group {
            margin-bottom: 16px;
        }

        .setting-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 12px;
        }

        .setting-input, .setting-select {
            width: 100%;
            padding: 12px;
            border-radius: 4px;
            background-color: white;
            border: 1px solid #d1d5db;
            color: black;
            font-size: 1.125rem;
            font-family: 'Courier New', monospace;
        }

        .setting-input:focus, .setting-select:focus {
            outline: none;
            border-color: black;
        }

        .time-adjuster {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .time-adjuster .label {
            font-size: 0.75rem;
            font-weight: 500;
            color: #6b7280;
            margin-bottom: 8px;
            text-align: center;
        }

        .time-value {
            font-size: 1.875rem;
            font-weight: 700;
            width: 64px;
            text-align: center;
        }

        .adj-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: #d1d5db;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .adj-btn:hover {
            background-color: #9ca3af;
        }

        .status-panel {
            background-color: #f3f4f6;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .status-panel .info {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .status-panel .audio {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
        }

        .hidden {
            display: none;
        }

        .round-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: black;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .round-btn:hover {
            background-color: #374151;
        }

        .round-btn.gray {
            background-color: #9ca3af;
        }

        .round-btn.gray:hover {
            background-color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Заголовок -->
        <div class="header">
            <h1>CROSSFIT</h1>
            <div class="line"></div>
            <p>TIMER</p>
        </div>

        <!-- Клікер -->
        <div class="counter">
            <div class="counter-label">COUNTER</div>
            <div class="counter-value" id="counterValue">0</div>
            <div class="counter-buttons">
                <button class="round-btn" onclick="incrementCounter()">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
                <button class="round-btn gray" onclick="resetCounter()">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="1,4 1,10 7,10"></polyline>
                        <path d="M3.51,15a9,9,0,0,0,2.13,3.09,9,9,0,0,0,13.22,0,9,9,0,0,0,0-12.75,9,9,0,0,0-13.22,0A8.9,8.9,0,0,0,3.51,9"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Вибір режиму -->
        <div class="mode-grid">
            <button class="mode-btn active" data-mode="stopwatch" onclick="changeMode('stopwatch')">STOPWATCH</button>
            <button class="mode-btn" data-mode="countdown" onclick="changeMode('countdown')">COUNTDOWN</button>
            <button class="mode-btn" data-mode="emom" onclick="changeMode('emom')">EMOM</button>
            <button class="mode-btn" data-mode="tabata" onclick="changeMode('tabata')">TABATA</button>
        </div>

        <!-- Основний дисплей -->
        <div class="display">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="status" id="statusDisplay">STOPWATCH</div>
            <div class="time" id="timeDisplay">00:00</div>
            <div class="indicator">
                <div class="dot" id="statusDot"></div>
            </div>
        </div>

        <!-- Кнопки управління -->
        <div class="controls">
            <button class="control-btn start-btn" id="startBtn" onclick="startStop()">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="5,3 19,12 5,21"></polygon>
                </svg>
            </button>
            <button class="control-btn reset-btn" onclick="reset()">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="1,4 1,10 7,10"></polyline>
                    <path d="M3.51,15a9,9,0,0,0,2.13,3.09,9,9,0,0,0,13.22,0,9,9,0,0,0,0-12.75,9,9,0,0,0-13.22,0A8.9,8.9,0,0,0,3.51,9"></path>
                </svg>
            </button>
            <button class="control-btn settings-btn" id="settingsBtn" onclick="toggleSettings()">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4,15a1.65,1.65,0,0,0,.33,1.82l.06.06a2,2,0,0,1,0,2.83,2,2,0,0,1-2.83,0l-.06-.06a1.65,1.65,0,0,0-1.82-.33,1.65,1.65,0,0,0-1,1.51V21a2,2,0,0,1-2,2,2,2,0,0,1-2-2V20.51a1.65,1.65,0,0,0-1.07-1.51,1.65,1.65,0,0,0-1.82.33l-.06.06a2,2,0,0,1-2.83,0,2,2,0,0,1,0-2.83l.06-.06a1.65,1.65,0,0,0,.33-1.82,1.65,1.65,0,0,0-1.51-1H3a2,2,0,0,1-2-2,2,2,0,0,1,2-2H3.49a1.65,1.65,0,0,0,1.51-1.07,1.65,1.65,0,0,0-.33-1.82L4.61,8.07a2,2,0,0,1,0-2.83,2,2,0,0,1,2.83,0L7.5,5.3a1.65,1.65,0,0,0,1.82.33H9.32a1.65,1.65,0,0,0,1-1.51V3a2,2,0,0,1,2-2,2,2,0,0,1,2,2V3.49a1.65,1.65,0,0,0,1,1.51,1.65,1.65,0,0,0,1.82-.33l.06-.06a2,2,0,0,1,2.83,0,2,2,0,0,1,0,2.83L20.7,7.5a1.65,1.65,0,0,0-.33,1.82v0a1.65,1.65,0,0,0,1.51,1H22a2,2,0,0,1,2,2,2,2,0,0,1-2,2H21.49a1.65,1.65,0,0,0-1.51,1Z"></path>
                </svg>
            </button>
        </div>

        <!-- Налаштування -->
        <div class="settings hidden" id="settingsPanel">
            <h3>SETTINGS</h3>
            
            <!-- Countdown налаштування -->
            <div id="countdownSettings" class="hidden">
                <div class="setting-label">COUNTDOWN TIME:</div>
                <div class="time-adjuster">
                    <div>
                        <div class="label">MINUTES</div>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <button class="adj-btn" onclick="adjustCountdownTime('minutes', 'down')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                            <div class="time-value" id="countdownMinutes">5</div>
                            <button class="adj-btn" onclick="adjustCountdownTime('minutes', 'up')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="time-adjuster">
                    <div>
                        <div class="label">SECONDS (5s STEPS)</div>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <button class="adj-btn" onclick="adjustCountdownTime('seconds', 'down')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                            <div class="time-value" id="countdownSeconds">0</div>
                            <button class="adj-btn" onclick="adjustCountdownTime('seconds', 'up')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EMOM налаштування -->
            <div id="emomSettings" class="hidden">
                <div class="setting-group">
                    <label class="setting-label">INTERVAL:</label>
                    <select class="setting-select" id="emomInterval">
                        <option value="1">EMOM (Every Minute)</option>
                        <option value="2">E2MOM (Every 2 Minutes)</option>
                        <option value="3">E3MOM (Every 3 Minutes)</option>
                        <option value="4">E4MOM (Every 4 Minutes)</option>
                        <option value="5">E5MOM (Every 5 Minutes)</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">TOTAL MINUTES:</label>
                    <input type="number" class="setting-input" id="emomMinutes" value="10">
                </div>
            </div>

            <!-- Tabata налаштування -->
            <div id="tabataSettings" class="hidden">
                <div class="setting-group">
                    <label class="setting-label">WORK TIME (SECONDS):</label>
                    <input type="number" class="setting-input" id="tabataWork" value="20">
                </div>
                <div class="setting-group">
                    <label class="setting-label">REST TIME (SECONDS):</label>
                    <input type="number" class="setting-input" id="tabataRest" value="10">
                </div>
                <div class="setting-group">
                    <label class="setting-label">ROUNDS:</label>
                    <input type="number" class="setting-input" id="tabataRounds" value="8">
                </div>
            </div>
        </div>

        <!-- Статус панель -->
        <div class="status-panel">
            <div class="info" id="statusInfo">UNLIMITED TIME TRACKING</div>
            <div class="audio">🔊 AUDIO ALERTS ENABLED</div>
        </div>
    </div>

    <script>
        // Змінні стану
        let mode = 'stopwatch';
        let time = 0;
        let isRunning = false;
        let initialTime = 300;
        let countdownMinutes = 5;
        let countdownSeconds = 0;
        let showSettings = false;
        let clickCounter = 0;
        let countdown = 0;
        let isCountingDown = false;

        // EMOM
        let emomMinutes = 10;
        let emomInterval = 1;
        let emomCurrentRound = 1;

        // Tabata
        let tabataWork = 20;
        let tabataRest = 10;
        let tabataRounds = 8;
        let tabataCurrentRound = 1;
        let tabataPhase = 'work';

        // Інтервали
        let mainInterval = null;
        let countdownInterval = null;

        // Елементи DOM
        const timeDisplay = document.getElementById('timeDisplay');
        const statusDisplay = document.getElementById('statusDisplay');
        const statusDot = document.getElementById('statusDot');
        const startBtn = document.getElementById('startBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        const progressFill = document.getElementById('progressFill');
        const statusInfo = document.getElementById('statusInfo');
        const counterValue = document.getElementById('counterValue');

        // Звукові сигнали
        function playBeep(count = 1, frequency = 800, duration = 0.3) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const context = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = context.createOscillator();
                    const gainNode = context.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(context.destination);
                    
                    oscillator.frequency.value = frequency;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, context.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + duration);
                    
                    oscillator.start();
                    oscillator.stop(context.currentTime + duration);
                }, i * 200);
            }
        }

        // Форматування часу
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Відлік перед стартом
        function startCountdown() {
            isCountingDown = true;
            countdown = 5;
            updateDisplay();
            
            countdownInterval = setInterval(() => {
                countdown--;
                if (countdown === 0) {
                    clearInterval(countdownInterval);
                    isCountingDown = false;
                    isRunning = true;
                    playBeep(2, 1000, 0.5); // довгий сигнал старту
                    startMainTimer();
                } else {
                    playBeep(1, 600, 0.2); // короткий сигнал відліку
                }
                updateDisplay();
            }, 1000);
        }

        // Основний таймер
        function startMainTimer() {
            mainInterval = setInterval(() => {
                if (mode === 'stopwatch') {
                    time++;
                } else if (mode === 'countdown') {
                    time--;
                    if (time <= 0) {
                        time = 0;
                        isRunning = false;
                        clearInterval(mainInterval);
                        playBeep(3, 1200, 0.8); // тройний довгий сигнал фінішу
                    }
                } else if (mode === 'emom') {
                    time++;
                    const intervalSeconds = emomInterval * 60;
                    if (time >= intervalSeconds) {
                        const totalIntervals = Math.floor(emomMinutes / emomInterval);
                        if (emomCurrentRound >= totalIntervals) {
                            isRunning = false;
                            clearInterval(mainInterval);
                            playBeep(3, 1200, 0.8); // тройний довгий сигнал фінішу
                        } else {
                            emomCurrentRound++;
                            playBeep(2, 800, 0.4); // подвійний сигнал для нового раунду
                            time = 0;
                        }
                    }
                    // Попередження за 3 секунди
                    if (time === intervalSeconds - 3) {
                        playBeep(1, 400, 0.2);
                    }
                } else if (mode === 'tabata') {
                    time--;
                    if (time <= 0) {
                        if (tabataPhase === 'work') {
                            tabataPhase = 'rest';
                            playBeep(1, 600, 0.3);
                            time = tabataRest;
                        } else {
                            if (tabataCurrentRound >= tabataRounds) {
                                isRunning = false;
                                clearInterval(mainInterval);
                                playBeep(3, 1200, 0.8); // тройний довгий сигнал фінішу
                            } else {
                                tabataCurrentRound++;
                                tabataPhase = 'work';
                                playBeep(2, 800, 0.4);
                                time = tabataWork;
                            }
                        }
                    }
                    // Попередження за 3 секунди
                    if (time === 3) {
                        playBeep(1, 400, 0.2);
                    }
                }
                updateDisplay();
            }, 1000);
        }

        // Старт/стоп
        function startStop() {
            if (!isRunning && !isCountingDown) {
                startCountdown();
            } else if (isRunning) {
                isRunning = false;
                clearInterval(mainInterval);
            } else if (isCountingDown) {
                clearInterval(countdownInterval);
                isCountingDown = false;
                countdown = 0;
            }
            updateDisplay();
        }

        // Скидання
        function reset() {
            isRunning = false;
            isCountingDown = false;
            countdown = 0;
            clearInterval(mainInterval);
            clearInterval(countdownInterval);
            
            if (mode === 'stopwatch') {
                time = 0;
            } else if (mode === 'countdown') {
                time = initialTime;
            } else if (mode === 'emom') {
                time = 0;
                emomCurrentRound = 1;
            } else if (mode === 'tabata') {
                time = tabataWork;
                tabataCurrentRound = 1;
                tabataPhase = 'work';
            }
            updateDisplay();
        }

        // Зміна режиму
        function changeMode(newMode) {
            mode = newMode;
            reset();
            
            // Оновлення активної кнопки
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${newMode}"]`).classList.add('active');
            
            // Показ відповідних налаштувань
            document.querySelectorAll('[id$="Settings"]').forEach(panel => {
                panel.classList.add('hidden');
            });
            
            if (newMode === 'countdown') {
                document.getElementById('countdownSettings').classList.remove('hidden');
            } else if (newMode === 'emom') {
                document.getElementById('emomSettings').classList.remove('hidden');
            } else if (newMode === 'tabata') {
                document.getElementById('tabataSettings').classList.remove('hidden');
            }
            
            updateDisplay();
        }

        // Показ/приховування налаштувань
        function toggleSettings() {
            showSettings = !showSettings;
            if (showSettings) {
                settingsPanel.classList.remove('hidden');
                settingsBtn.classList.add('active');
            } else {
                settingsPanel.classList.add('hidden');
                settingsBtn.classList.remove('active');
            }
        }

        // Налаштування countdown
        function adjustCountdownTime(type, direction) {
            if (type === 'minutes') {
                if (direction === 'up') {
                    countdownMinutes = Math.min(countdownMinutes + 1, 99);
                } else {
                    countdownMinutes = Math.max(countdownMinutes - 1, 0);
                }
            } else {
                if (direction === 'up') {
                    countdownSeconds += 5;
                    if (countdownSeconds >= 60) {
                        countdownMinutes = Math.min(countdownMinutes + 1, 99);
                        countdownSeconds -= 60;
                    }
                    countdownSeconds = Math.min(countdownSeconds, 55);
                } else {
                    countdownSeconds -= 5;
                    if (countdownSeconds < 0) {
                        if (countdownMinutes > 0) {
                            countdownMinutes--;
                            countdownSeconds = 55;
                        } else {
                            countdownSeconds = 0;
                        }
                    }
                }
            }
            
            initialTime = countdownMinutes * 60 + countdownSeconds;